{{- template "migrate-header" . -}}
{{ heading 4 "`atlas schema apply` Summary:" }}
{{- with .Plan -}}
<table>
  <tr>
    <td>Database URL</td>
    <td>`{{ $.URL }}`</td>
  </tr>
  {{- with .File -}}
  <tr>
    <td>Plan Name</td>
    <td>`{{ .Name }}`</td>
  </tr>
  <tr>
    <td>From Hash</td>
    <td>`{{ .FromHash }}`</td>
  </tr>
  <tr>
    <td>To Hash</td>
    <td>`{{ .ToHash }}`</td>
  </tr>
    {{- if .URL -}}
  <tr>
    <td>Plan URL</td>
    <td>
      {{- $planURL := printf "<code>%s</code>" .URL -}}
      {{- with .Link -}}
        {{- . | link $planURL -}}
      {{- else -}}
        {{- $planURL -}}
      {{- end -}}
    </td>
  </tr>
    {{- end -}}
    {{- with .Status -}}
  <tr><td>Plan Status</td><td>{{ . }}</td></tr>
    {{- end -}}
  {{- end -}}
  {{- with $.Error -}}
  <tr><td>Error</td><td>{{ . }}</td></tr>
  {{- else -}}
  <tr>
    <td>Total Time</td>
    <td>{{ execTime $.Start $.End }}</td>
  </tr>
  {{- end -}}
</table>
  {{- if $.Applied -}}
    {{- template "applied-file" $.Applied -}}
  {{- end -}}
  {{- $kind := or (and .File.URL "Pre-planned SQL") "SQL" -}}
  {{- .File.Migration | codeblock "sql" | details (printf "ðŸ“„ View %s Statements" $kind) -}}
  {{- with .Lint -}}
{{ heading 4 "Atlas lint results" }}
    {{- template "schema-lint" $ -}}
  {{- end -}}
{{/* Fallback to the old output */}}
{{- else with .Changes -}}
  {{- with .Error -}}
The following SQL statement failed to execute:
    {{ .Stmt | codeblock "sql" }}
Database returned the following error:
    {{- .Text | codeblock "" -}}
  {{- end -}}
  {{- with .Applied -}}
    {{- join . "\n" | codeblock "sql" | details "ðŸ“„ Succeeded SQL Applied" -}}
  {{- end -}}
  {{- with .Pending -}}
    {{- join . "\n" | codeblock "sql" | details "ðŸ“„ Pending SQL statements" -}}
  {{- end }}
{{- end -}}
