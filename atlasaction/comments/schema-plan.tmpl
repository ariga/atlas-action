{{ heading 3 "Atlas detected changes to the desired schema" }}
{{- with .Plan.File.Link }}
{{ . | link "View on Atlas Cloud" | printf "Migration Plan (%s)" | heading 4 -}}
{{ else }}
{{ heading 4 "Migration Plan" -}}
{{ end }}

{{/* Respect double new lines as they are skipped in <pre/code> blocks. */}}
{{- with .Plan.File.Migration }}
```sql
{{ trimRight . "\n" }}
```
{{- end }}

{{ heading 4 "Atlas lint results" }}
{{ template "schema-lint" . -}}
{{ separator }}
<details>
<summary>üìù Steps to edit this migration plan</summary>

1\. Run the following command to pull the generated plan to your local workstation:
```bash
atlas schema plan pull --url "{{ .Plan.File.URL }}" > {{ .Plan.File.Name }}.plan.hcl
```

2\. Open `{{ .Plan.File.Name }}` in your editor and modify it as needed. Note that the result of the plan should align
the database with the desired state. Otherwise, Atlas will report a schema drift.

3\. Push the updated plan to the registry using the following command:
```bash
atlas schema plan push --pending --env {{ .EnvName }} --file {{ .Plan.File.Name }}.plan.hcl
```

{{- if .RerunCommand }}
4\. Re-trigger the `schema/plan` action to update this comment:
```bash
{{ .RerunCommand }}
```
{{- end }}

</details>
{{- define "schema-lint" -}}
| Status | Step | Result |
| :---: | :--- | :--- |
{{ with .Plan.File -}}
{{- $stmtCount := len .Stmts -}}
| {{ template "lint-check" "success.svg" }} | Detect schema changes |
{{- if eq $stmtCount 1 }} 1 new statement detected
{{- else if $stmtCount }} {{ $stmtCount }} new statements detected
{{- else }} No statements detected
{{- end }}
{{- end -}}
{{- template "lint-report" .Plan.Lint -}}
{{- end -}}
