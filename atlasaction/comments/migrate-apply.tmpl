{{- block "migrate-header" . -}}
{{- if .Error -}}
{{- assetsImage "error.svg" | image "22px" | printf "%s Migration Failed" | heading 2 }}
{{- else -}}
{{- assetsImage "success.svg" | image "22px" | printf "%s Migration Passed" | heading 2 }}
{{- end -}}
{{- end -}}
{{ heading 4 "`atlas migrate apply`" }}
<table>
  <tr>
    <th>Parameter</th>
    <th>Details</th>
  </tr>
  <tr>
    <td>Migration Directory</td>
    <td><code>{{ .Dir }}</code></td>
  </tr>
  <tr>
    <td>Database URL</td>
    <td><code>{{ .URL.URL }}</code></td>
  </tr>
  {{- with .Current }}
  <tr>
    <td>Migrate from Version</td>
    <td><code>{{ . }}</code></td>
  </tr>
  {{- end }}
  <tr>
    <td>Migrate to Version</td>
    <td>
      <code>{{- or .Target .Current -}}</code>
    </td>
  </tr>
  <tr>
    <td>SQL Summary</td>
    <td>
      {{- len .Applied }} migration file{{- if or (not .Applied) (gt (len .Applied) 1) }}s{{- end -}}
      {{- with (appliedStmts .) -}}
      , {{ . }} statement{{- if gt . 1 }}s{{- end }} passed
      {{- end -}}
      {{- if .Error -}}, 1 failed{{- end -}}
    </td>
  </tr>
  <tr>
    <td>Total Time</td>
    <td>{{ execTime .Start .End }}</td>
  </tr>
</table>
{{- range .Applied -}}
{{- block "applied-file" . -}}
{{ printf "Version %s" .Name | heading 4 }}
<table>
  <tr>
    <th>Status</th>
    <th>Executed Statements</th>
    <th>Execution Time</th>
    <th>Error</th>
    <th>Error Statement</th>
  </tr>
  <tr>
    <td>{{- template "lint-check" (or (and .Error "error.svg") "success.svg") -}}</td>
    <td>{{ len .Applied }}</td>
    <td>{{ execTime .Start .End }}</td>
{{- with .Error -}}
    <td>{{- .Text -}}</td><td>{{- .Stmt | codeblock "sql" | details "ðŸ“„ View" -}}</td>
{{- else -}}
    <td>-</td><td>-</td>
{{- end -}}
  </tr>
</table>
{{- end -}}
{{- join .Applied "\n" | codeblock "sql" | details "ðŸ“„ View SQL Statements" -}}
{{- end -}}