{{- define "lint-report" -}}
<table>
  <thead>
    <tr>
      <th>Status</th>
      <th>Step</th>
      <th>Result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
  {{- block "lint-first-step" . -}}
    {{- template "lint-check" "success.svg" -}}
      <td>
        {{- $fileCount := len .Files -}}
        {{- if eq $fileCount 1 -}}
        1 new migration file detected
        {{- else if $fileCount -}}
        {{- $fileCount }} new migration files detected
        {{- else -}}
        No migration files detected
        {{- end -}}
      </td>
      <td>
        {{- with .Files -}}
          {{- range $i, $f := . -}}
          {{- if $i -}}<br/>{{- end -}}{{- $f.Name -}}
          {{- end -}}
        {{- else -}}
          &nbsp;
        {{- end -}}
      </td>
  {{- end -}}
    </tr>
{{- with .URL -}}
    <tr>
      {{- template "lint-check" "success.svg" -}}
      <td>ERD and visual diff generated</td>
      <td>
        {{- printf "%s#erd" . | link "View Visualization" -}}
      </td>
    </tr>
{{- end -}}
{{- with (.Steps | filterIssues) -}}
  {{- range $step := . -}}
    <tr>
      {{- template "lint-check" (or (and ($step | stepIsError) "error.svg") "warning.svg") -}}
      <td>{{- $step.Name -}}<br/>{{- $step.Text -}}</td>
      <td>
      {{- if and $step.Error (not $step.Result) -}}
        {{- $step.Error -}}
      {{- else if $step.Result -}}
        {{- range $step.Result.Reports -}}
          {{- with .Text -}}<b>{{ . | firstUpper }}</b><br/>{{- end -}}
          {{- range .Diagnostics -}}
            {{- .Text -}}
            {{- with .Code -}}
              &nbsp;{{- printf "https://atlasgo.io/lint/analyzers#%s" . | link (printf "(%s)" . ) -}}
            {{- end -}}
            <br/>
          {{- end -}}
        {{- end -}}
      {{- end -}}
      </td>
    </tr>
  {{- end -}}
{{- else -}}
    <tr>
      {{- template "lint-check" "success.svg" -}}
      <td>No issues found</td>
      <td>{{- with .URL }}{{ . | link "View Report" }}{{- end -}}</td>
    </tr>
{{- end -}}
{{- with .URL -}}
    <tr><td colspan="4"><div align="center">Read the full linting report on {{ . | link "Atlas Cloud" -}}</div></td></tr>
{{- end -}}
  </tbody>
</table>
{{- end -}}
{{- define "lint-check" -}}
<td><div align="center">{{- assetsImage . | image "20px" -}}</div></td>
{{- end -}}