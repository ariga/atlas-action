# Mock the atlas command outputs
env ATLAS_PATH=$MOCK_ATLAS TEST_BATCH=./migrate-apply
# Setup the action input variables
env INPUT_DIR=file://migrations
env INPUT_URL=sqlite://./a.db?cache=shared&_fk=1
env INPUT_TO-VERSION=20250812113110

atlas-action --action=migrate/apply
stdout '"atlas migrate apply" completed successfully, applied to version "20250812113110"'
output output.txt

-- migrate-apply/1/args --
migrate apply --format {{ json . }} --context {"triggerType":"GITHUB_ACTION","triggerVersion":"testscript"} --url sqlite://./a.db?cache=shared&_fk=1 --dir file://migrations --to-version 20250812113110
-- migrate-apply/1/stdout --
{"Driver":"sqlite3","URL":{"Scheme":"sqlite","Opaque":"","User":null,"Host":".","Path":"/a.db","RawPath":"","OmitHost":false,"ForceQuery":false,"RawQuery":"cache=shared\u0026_fk=1","Fragment":"","RawFragment":"","Schema":"main"},"Dir":"file://migrations","Pending":[{"Name":"20250812113056.sql","Version":"20250812113056"},{"Name":"20250812113110.sql","Version":"20250812113110"}],"Applied":[{"Name":"20250812113056.sql","Version":"20250812113056","Start":"2025-08-12T18:33:33.639168+07:00","End":"2025-08-12T18:33:33.640468+07:00","Applied":["CREATE TABLE t1(a int);"]},{"Name":"20250812113110.sql","Version":"20250812113110","Start":"2025-08-12T18:33:33.640468+07:00","End":"2025-08-12T18:33:33.641098+07:00","Applied":["CREATE TABLE t2(b int);"]}],"Target":"20250812113110","Start":"2025-08-12T18:33:33.635359+07:00","End":"2025-08-12T18:33:33.641098+07:00","Message":"Migrated to version 20250812113110 from  (2 migrations in total)"}
-- output.txt --
current<<_GitHubActionsFileCommandDelimeter_

_GitHubActionsFileCommandDelimeter_
target<<_GitHubActionsFileCommandDelimeter_
20250812113110
_GitHubActionsFileCommandDelimeter_
applied_count<<_GitHubActionsFileCommandDelimeter_
2
_GitHubActionsFileCommandDelimeter_
pending_count<<_GitHubActionsFileCommandDelimeter_
2
_GitHubActionsFileCommandDelimeter_
runs<<_GitHubActionsFileCommandDelimeter_
[{"current":"","target":"20250812113110","applied_count":2,"pending_count":2}]
_GitHubActionsFileCommandDelimeter_
