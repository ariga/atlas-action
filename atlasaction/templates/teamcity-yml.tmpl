# Generated by go run ./cmd/gen teamcity-template; DO NOT EDIT.
name: ariga/atlas-{{ .ID | replace "/" "-" }}
title: Atlas {{ .Name }}
version: {{ .Version }}
description: >
  {{ .Description }}
inputs:
  - env.ATLAS_VERSION:
      type: text
      label: Atlas Version
      description: The version of Atlas CLI to install.
      default: latest
{{- if ne .ID "monitor/schema" }}
  - env.ATLAS_TOKEN:
      type: password
      label: Atlas Cloud Token
      description: Atlas Cloud token for authentication.
      required: false
{{- end }}
{{- range $name, $input := .SortedInputs }}
  - env.{{ $name | inputvar }}:
{{- if eq $input.Type "boolean" }}
      type: boolean
{{- else if $input.Options }}
      type: select
      options:
        {{- range $v := $input.Options }}
        - {{ $v }}
        {{- end }}
{{- else if or (eq $input.Type "password") (contains $name "token") }}
      type: password
{{- else }}
      type: text
{{- end }}
      label: {{ with $input.Label }}{{ . }}{{ else }}{{ $name }}{{ end }}
      description: >
        {{ $input.Description | nl2sp | trimnl }}
      required: {{ $input.Required }}
{{- if $input.Default }}
      default: "{{ $input.Default }}"
{{- end }}
{{- end }}
steps:
  - name: Setup Atlas CLI
    script: |
      #!/bin/bash
      set -eo pipefail
      curl -sSf https://release.ariga.io/atlas-action/scripts-v{{ .Version }}/setup-atlas.sh \
        | CI=true sh
  - name: Run {{ .Name }}
    script: |
      #!/bin/bash
      set -eo pipefail
      export ATLAS_ACTION_VERSION={{ .Version | majorver | printf "v%s" }}
      curl -sSf https://release.ariga.io/atlas-action/scripts-v{{ .Version }}/shim.sh \
        | CI=true sh -s -- {{ .ID }}
