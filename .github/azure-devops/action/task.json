{
  "$schema": "https://raw.githubusercontent.com/Microsoft/azure-pipelines-task-lib/master/tasks.schema.json",
  "id": "9f96e670-85cc-4764-b83f-9824a9747edd",
  "author": "ariga",
  "name": "AtlasAction",
  "friendlyName": "Atlas Action",
  "description": "Atlas Action for Azure DevOps",
  "helpMarkDown": "",
  "category": "Azure Pipelines",
  "version": {
    "Major": 0,
    "Minor": 0,
    "Patch": 0
  },
  "execution": {
    "Node": {
      "target": "shim.js",
      "argumentFormat": ""
    },
    "Node10": {
      "target": "shim.js",
      "argumentFormat": ""
    },
    "Node16": {
      "target": "shim.js",
      "argumentFormat": ""
    },
    "Node20_1": {
      "target": "shim.js",
      "argumentFormat": ""
    }
  },
  "instanceNameFormat": "Atlas Action: $(action)",
  "inputs": [
    {
      "type": "pickList",
      "label": "Action",
      "helpMarkDown": "Select an action to use at this job.",
      "required": true,
      "name": "action",
      "options": {
        "migrate apply": "Migrate Apply",
        "migrate autorebase": "Migrate Auto Rebase",
        "migrate diff": "Migrate Diff",
        "migrate down": "Migrate Down",
        "migrate lint": "Migrate Lint",
        "migrate push": "Migrate Push",
        "migrate test": "Migrate Test",
        "monitor schema": "Monitor Schema",
        "schema apply": "Schema Apply",
        "schema lint": "Schema Lint",
        "schema plan approve": "Schema Plan Approve",
        "schema plan": "Schema Plan",
        "schema push": "Schema Push",
        "schema test": "Schema Test"
      }
    },
    {
      "type": "string",
      "label": "Working directory",
      "helpMarkDown": "Atlas working directory, default is project root",
      "name": "working_directory",
      "visibleRule": "action == migrate apply || action == migrate autorebase || action == migrate diff || action == migrate down || action == migrate lint || action == migrate push || action == migrate test || action == schema apply || action == schema lint || action == schema plan || action == schema plan approve || action == schema push || action == schema test"
    },
    {
      "type": "string",
      "label": "Configuration",
      "helpMarkDown": "The URL of the Atlas configuration file. By default, Atlas will look for a file\nnamed `atlas.hcl` in the current directory. For example, `file://config/atlas.hcl`.\nLearn more about [Atlas configuration files](https://atlasgo.io/atlas-schema/projects).\n",
      "name": "config",
      "visibleRule": "action == migrate apply || action == migrate diff || action == migrate down || action == migrate lint || action == migrate push || action == migrate test || action == monitor schema || action == schema apply || action == schema lint || action == schema plan || action == schema plan approve || action == schema push || action == schema test"
    },
    {
      "type": "string",
      "label": "Environment",
      "helpMarkDown": "The environment to use from the Atlas configuration file.  For example, `dev`.",
      "name": "env",
      "visibleRule": "action == migrate apply || action == migrate diff || action == migrate down || action == migrate lint || action == migrate push || action == migrate test || action == monitor schema || action == schema apply || action == schema lint || action == schema plan || action == schema plan approve || action == schema push || action == schema test"
    },
    {
      "type": "string",
      "label": "Variables",
      "helpMarkDown": "A JSON object containing variables to be used in the Atlas configuration file.\nFor example, `{\"var1\": \"value1\", \"var2\": \"value2\"}`.\n",
      "name": "vars",
      "visibleRule": "action == migrate apply || action == migrate diff || action == migrate down || action == migrate lint || action == migrate push || action == migrate test || action == schema apply || action == schema lint || action == schema plan || action == schema plan approve || action == schema push || action == schema test"
    },
    {
      "type": "string",
      "label": "URL",
      "helpMarkDown": "The URL of the target database. For example: `mysql://root:pass@localhost:3306/dev`.",
      "name": "url",
      "visibleRule": "action == migrate apply || action == migrate down || action == monitor schema || action == schema apply || action == schema lint || action == schema push || action == schema test"
    },
    {
      "type": "string",
      "label": "Dev URL",
      "helpMarkDown": "The URL of the dev-database to use for analysis. For example: `mysql://root:pass@localhost:3306/dev`.\nRead more about [dev-databases](https://atlasgo.io/concepts/dev-database).\n",
      "name": "dev_url",
      "visibleRule": "action == migrate diff || action == migrate down || action == migrate lint || action == migrate push || action == migrate test || action == schema apply || action == schema lint || action == schema plan || action == schema plan approve || action == schema push || action == schema test"
    },
    {
      "type": "multiLine",
      "label": "schema",
      "helpMarkDown": "List of database schema(s). For example: `public`.\n",
      "name": "schema",
      "visibleRule": "action == schema apply || action == schema lint || action == schema plan || action == schema plan approve || action == schema push"
    },
    {
      "type": "multiLine",
      "label": "exclude",
      "helpMarkDown": "List of exclude patterns from inspection. see: https://atlasgo.io/declarative/inspect#exclude-schemas",
      "name": "exclude",
      "visibleRule": "action == monitor schema || action == schema apply || action == schema plan || action == schema plan approve"
    },
    {
      "type": "int",
      "label": "amount",
      "helpMarkDown": "The maximum number of migration files to apply, default is all.",
      "name": "amount",
      "visibleRule": "action == migrate apply || action == migrate down"
    },
    {
      "type": "string",
      "label": "Base branch",
      "helpMarkDown": "The base branch to rebase the migration directory onto. Default to the default branch of the repository.\n",
      "name": "base_branch",
      "visibleRule": "action == migrate autorebase"
    },
    {
      "type": "string",
      "label": "Cloud token",
      "helpMarkDown": "The token that is used to connect to Atlas Cloud (should be passed as a secret).",
      "name": "cloud_token",
      "visibleRule": "action == monitor schema"
    },
    {
      "type": "string",
      "label": "description",
      "helpMarkDown": "The description of the schema.",
      "name": "description",
      "visibleRule": "action == schema push"
    },
    {
      "type": "string",
      "label": "dir",
      "helpMarkDown": "The URL of the migration directory to apply. For example: `atlas://dir-name` for cloud\nbased directories or `file://migrations` for local ones.\n",
      "name": "dir",
      "visibleRule": "action == migrate apply || action == migrate autorebase || action == migrate diff || action == migrate down || action == migrate lint || action == migrate push || action == migrate test"
    },
    {
      "type": "string",
      "label": "Directory name",
      "helpMarkDown": "The name (slug) of the project in Atlas Cloud.",
      "name": "dir_name",
      "visibleRule": "action == migrate lint || action == migrate push"
    },
    {
      "type": "multiLine",
      "label": "From",
      "helpMarkDown": "URL(s) of the current schema state.\n",
      "name": "from",
      "visibleRule": "action == schema plan || action == schema plan approve"
    },
    {
      "type": "multiLine",
      "label": "Include",
      "helpMarkDown": "list of glob patterns used to select which resources to keep in inspection\nsee: https://atlasgo.io/declarative/inspect#include-schemas-\n",
      "name": "include",
      "visibleRule": "action == schema apply || action == schema plan || action == schema plan approve"
    },
    {
      "type": "pickList",
      "label": "Lint Review",
      "helpMarkDown": "Automatically generate an approval plan before applying changes.\nUse \"ALWAYS\" to generate a plan for every apply, or \"WARNING\" and \"ERROR\" to generate a plan only based on review policy.\n",
      "name": "lint_review",
      "options": {
        "ALWAYS": "Always",
        "ERROR": "Error",
        "WARNING": "Warning"
      },
      "visibleRule": "action == schema apply"
    },
    {
      "type": "string",
      "label": "name",
      "helpMarkDown": "The name of the plan. By default, Atlas will generate a name based on the schema changes.\n",
      "name": "name",
      "visibleRule": "action == schema plan"
    },
    {
      "type": "multiLine",
      "label": "paths",
      "helpMarkDown": "the list of directories containing test files. \n",
      "name": "paths",
      "visibleRule": "action == migrate test || action == schema test"
    },
    {
      "type": "string",
      "label": "Plan",
      "helpMarkDown": "The plan to apply. For example, `atlas://<schema>/plans/<id>`.",
      "name": "plan",
      "visibleRule": "action == schema apply || action == schema plan approve"
    },
    {
      "type": "string",
      "label": "remote",
      "helpMarkDown": "The remote to fetch from. Defaults to `origin`.\n",
      "name": "remote",
      "visibleRule": "action == migrate autorebase || action == migrate diff"
    },
    {
      "type": "string",
      "label": "Revisions schema",
      "helpMarkDown": "The name of the schema containing the revisions table.",
      "name": "revisions_schema",
      "visibleRule": "action == migrate apply || action == migrate down || action == migrate test"
    },
    {
      "type": "string",
      "label": "Run",
      "helpMarkDown": "Filter tests to run by regexp. For example, `^test_.*` will only run tests that start with `test_`.\nDefault is to run all tests.\n",
      "name": "run",
      "visibleRule": "action == migrate test || action == schema test"
    },
    {
      "type": "string",
      "label": "Schema name",
      "helpMarkDown": "The name (slug) of the project in Atlas Cloud.",
      "name": "schema_name",
      "visibleRule": "action == schema plan || action == schema plan approve || action == schema push"
    },
    {
      "type": "multiLine",
      "label": "schemas",
      "helpMarkDown": "List of database schemas to include (by default includes all schemas). see: https://atlasgo.io/declarative/inspect#inspect-multiple-schemas",
      "name": "schemas",
      "visibleRule": "action == monitor schema"
    },
    {
      "type": "string",
      "label": "slug",
      "helpMarkDown": "Optional unique identifier for the database server.",
      "name": "slug",
      "visibleRule": "action == monitor schema"
    },
    {
      "type": "string",
      "label": "tag",
      "helpMarkDown": "The tag of migrations to used as base for linting. By default, the `latest` tag is used.\n",
      "name": "tag",
      "visibleRule": "action == migrate lint || action == migrate push || action == schema push"
    },
    {
      "type": "string",
      "label": "To",
      "helpMarkDown": "The URL of the desired state.\n",
      "name": "to",
      "visibleRule": "action == migrate diff || action == schema apply || action == schema plan || action == schema plan approve"
    },
    {
      "type": "string",
      "label": "To tag",
      "helpMarkDown": "The tag to revert to. Mutually exclusive with `amount` and `to-version`.",
      "name": "to_tag",
      "visibleRule": "action == migrate down"
    },
    {
      "type": "string",
      "label": "To version",
      "helpMarkDown": "The version to revert to. Mutually exclusive with `amount` and `to-tag`.",
      "name": "to_version",
      "visibleRule": "action == migrate down"
    },
    {
      "type": "pickList",
      "label": "Transaction mode",
      "helpMarkDown": "Transaction mode to use. Either \"file\", \"all\", or \"none\". Default is \"file\".\n",
      "name": "tx_mode",
      "defaultValue": "file",
      "options": {
        "file": "file",
        "all": "all",
        "none": "none"
      },
      "visibleRule": "action == migrate apply || action == schema apply"
    },
    {
      "type": "string",
      "label": "Version",
      "helpMarkDown": "The version of the schema.",
      "name": "version",
      "visibleRule": "action == schema push"
    },
    {
      "type": "string",
      "label": "Wait interval",
      "helpMarkDown": "Time in seconds between different migrate down attempts.",
      "name": "wait_interval",
      "visibleRule": "action == migrate down || action == schema apply"
    },
    {
      "type": "string",
      "label": "Wait timeout",
      "helpMarkDown": "Time after which no other retry attempt is made and the action exits.",
      "name": "wait_timeout",
      "visibleRule": "action == migrate down || action == schema apply"
    },
    {
      "type": "boolean",
      "label": "Latest",
      "helpMarkDown": "If true, push also to the \"latest\" tag.\n",
      "defaultValue": "true",
      "name": "latest",
      "visibleRule": "action == migrate push || action == schema push"
    },
    {
      "type": "boolean",
      "label": "Allow dirty",
      "helpMarkDown": "Allow start working on a non-clean database.",
      "name": "allow_dirty",
      "visibleRule": "action == migrate apply"
    },
    {
      "type": "boolean",
      "label": "Auto approve",
      "helpMarkDown": "Automatically approve and apply changes. Either \"true\" or \"false\".",
      "name": "auto_approve",
      "visibleRule": "action == schema apply"
    },
    {
      "type": "boolean",
      "label": "Dry run",
      "helpMarkDown": "Print SQL without executing it. Either \"true\" or \"false\".",
      "name": "dry_run",
      "visibleRule": "action == migrate apply || action == schema apply"
    }
  ]
}
